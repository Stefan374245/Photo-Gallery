<div class="dialog-container">
  <div class="dialog-header">
    <h2 mat-dialog-title>Foto {{ currentIndex + 1 }} / {{ allPhotos.length }}</h2>
    <div class="header-actions">
      <button 
        mat-icon-button 
        (click)="toggleFavorite()"
        [title]="currentPhoto.isFavorite ? 'Von Favoriten entfernen' : 'Zu Favoriten hinzufügen'"
        [class.favorite-active]="currentPhoto.isFavorite">
        <mat-icon>{{ currentPhoto.isFavorite ? 'favorite' : 'favorite_border' }}</mat-icon>
      </button>
      <button mat-icon-button (click)="close()" class="close-button">
        <mat-icon>close</mat-icon>
      </button>
    </div>
  </div>

  <mat-dialog-content class="dialog-content">
    <!-- 3D Carousel -->
    <div class="carousel-container">
      <div class="carousel-3d" 
           [class.animating]="isAnimating"
           [style.transform]="getCarouselTransform()">
        <div class="carousel-item" 
             *ngFor="let photo of allPhotos; let i = index"
             [class.active]="i === currentIndex"
             [class.prev]="i === getPrevIndex()"
             [class.next]="i === getNextIndex()"
             [style.transform]="getItemTransform(i)">
          <img [src]="photo.url" 
               [alt]="photo.description || 'Foto'" 
               [title]="photo.description || 'Foto'"
               class="carousel-image">
        </div>
      </div>
      
      <!-- Navigation Buttons -->
      <button mat-icon-button 
              class="carousel-nav carousel-nav-prev" 
              (click)="previousSlide()"
              [disabled]="isAnimating">
        <mat-icon>chevron_left</mat-icon>
      </button>
      
      <button mat-icon-button 
              class="carousel-nav carousel-nav-next" 
              (click)="nextSlide()"
              [disabled]="isAnimating">
        <mat-icon>chevron_right</mat-icon>
      </button>
      
      <!-- Indicators -->
      <div class="carousel-indicators">
        <button *ngFor="let photo of allPhotos; let i = index"
                class="indicator"
                [class.active]="i === currentIndex"
                (click)="goToSlide(i)"
                [disabled]="isAnimating"
                [attr.aria-label]="'Zu Bild ' + (i + 1) + ' gehen'"
                [title]="'Zu Bild ' + (i + 1) + ' gehen'">
        </button>
      </div>
    </div>
    
    <div class="description-section">
      <div *ngIf="!isEditing" class="description-display">
        <p *ngIf="currentPhoto.description" class="description-text">{{ currentPhoto.description }}</p>
        <p *ngIf="!currentPhoto.description" class="no-description">Keine Beschreibung</p>
        <button mat-button color="primary" (click)="startEditing()">
          <mat-icon>edit</mat-icon>
          Beschreibung bearbeiten
        </button>
      </div>

      <div *ngIf="isEditing" class="description-edit">
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Beschreibung</mat-label>
          <textarea 
            matInput 
            rows="4" 
            [(ngModel)]="description"
            placeholder="Beschreibung hinzufügen...">
          </textarea>
        </mat-form-field>
        
        <div class="edit-actions">
          <button 
            mat-button 
            (click)="cancelEditing()"
            [disabled]="saving">
            Abbrechen
          </button>
          <button 
            mat-raised-button 
            color="primary" 
            (click)="saveDescription()"
            [disabled]="saving">
            <span *ngIf="!saving">Speichern</span>
            <span *ngIf="saving">Wird gespeichert...</span>
          </button>
        </div>
      </div>
    </div>

    <div class="photo-info">
      <p class="info-item">
        <mat-icon>description</mat-icon>
        <span>Dateiname: {{ currentPhoto.filename }}</span>
      </p>
    </div>
  </mat-dialog-content>
</div>